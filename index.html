<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <!-- –ü–æ–¥–æ–±—Ä–µ–Ω viewport –∑–∞ –º–æ–±–∏–ª–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VideoQuiz Lite+ Mobile</title>
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- –ö–æ–º–ø—Ä–µ—Å–∏—è -->
    <script src="https://unpkg.com/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <!-- QR –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä (–æ—Ñ–ª–∞–π–Ω) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –®—Ä–∏—Ñ—Ç -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-pop { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
        .draggable-item { touch-action: none; user-select: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* –ü–æ-–≥–æ–ª—è–º–∞ –ø–ª–æ—â –∑–∞ –¥–æ–∫–æ—Å–≤–∞–Ω–µ –Ω–∞ –µ—Ç–∏–∫–µ—Ç–∏—Ç–µ */
        .draggable-item::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: transparent;
        }
        
        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞–Ω–µ –Ω–∞ zoom –ø—Ä–∏ —Ñ–æ–∫—É—Å –≤ iOS */
        input, select, textarea, button {
            font-size: 16px !important;
        }
        
        /* –ü–æ–¥–æ–±—Ä–µ–Ω–∞ —á–µ—Ç–∏–º–æ—Å—Ç –Ω–∞ –º–∞–ª–∫–∏ –µ–∫—Ä–∞–Ω–∏ */
        @media (max-width: 640px) {
            .text-xs { font-size: 13px !important; }
            .text-sm { font-size: 14px !important; }
            .text-base { font-size: 16px !important; }
            h1, h2, h3 { word-break: break-word; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        // ==================== –ü–û–ú–û–©–ù–ò –§–£–ù–ö–¶–ò–ò ====================
        const { useState, useEffect, useRef, useImperativeHandle, forwardRef } = React;

        const getYouTubeId = (url) => {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        };

        // ==================== QR –ö–û–î –ö–û–ú–ü–û–ù–ï–ù–¢ ====================
        const QRCodeSVG = ({ value, size }) => {
            const [qrSvg, setQrSvg] = useState('');
            useEffect(() => {
                if (window.qrcode) {
                    const qr = window.qrcode(0, 'H');
                    qr.addData(value);
                    qr.make();
                    setQrSvg(qr.createSvgTag({ cellSize: 4, margin: 0, scalable: true }));
                }
            }, [value]);
            return <div dangerouslySetInnerHTML={{ __html: qrSvg }} style={{ width: size, height: size }} />;
        };

        // ==================== –ò–ö–û–ù–ò ====================
        const Icons = {
            Video: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2"/></svg>,
            Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="11" x="3" y="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Share: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></svg>,
            Check: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><polyline points="20 6 9 17 4 12"/></svg>,
            Alert: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Clock: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Youtube: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17"/><path d="m10 15 5-3-5-3z"/></svg>,
            Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Refresh: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Move: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="19 9 22 12 19 15"/><polyline points="15 19 12 22 9 19"/><line x1="12" x2="12" y1="2" y2="22"/><line x1="2" x2="22" y1="12" y2="12"/></svg>,
            Chat: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Star: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Fullscreen: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>
        };

        // ==================== –ú–ï–î–ò–ê –ü–õ–ï–ô–™–† ====================
        const MediaPlayer = forwardRef(({ url, onReady }, ref) => {
            const videoRef = useRef(null);
            const youtubePlayerRef = useRef(null);
            const [isYoutube, setIsYoutube] = useState(false);
            const [ytId, setYtId] = useState(null);
            const [apiReady, setApiReady] = useState(false);
            const [playerReady, setPlayerReady] = useState(false);
            const playerId = useRef(`yt-player-${Math.random().toString(36).substr(2, 9)}`).current;

            useEffect(() => {
                const id = getYouTubeId(url);
                setYtId(id);
                setIsYoutube(!!id);
                setPlayerReady(false);
            }, [url]);

            useEffect(() => {
                if (isYoutube) {
                    if (window.YT && window.YT.Player) {
                        setApiReady(true);
                    } else if (!window.YT) {
                        const tag = document.createElement('script');
                        tag.src = "https://www.youtube.com/iframe_api";
                        const firstScriptTag = document.getElementsByTagName('script')[0];
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                        window.onYouTubeIframeAPIReady = () => setApiReady(true);
                    }
                }
            }, [isYoutube]);

            useEffect(() => {
                if (isYoutube && ytId && apiReady) {
                    if (youtubePlayerRef.current) {
                        try { youtubePlayerRef.current.destroy(); } catch(e) {}
                    }
                    setTimeout(() => {
                        youtubePlayerRef.current = new window.YT.Player(playerId, {
                            height: '100%',
                            width: '100%',
                            videoId: ytId,
                            playerVars: { 'playsinline': 1, 'controls': 1, 'rel': 0, 'modestbranding': 1 },
                            events: {
                                onReady: () => { setPlayerReady(true); if (onReady) onReady(); }
                            }
                        });
                    }, 100);
                }
            }, [isYoutube, ytId, apiReady, onReady]);

            useImperativeHandle(ref, () => ({
                play: () => isYoutube ? youtubePlayerRef.current?.playVideo() : videoRef.current?.play(),
                pause: () => isYoutube ? youtubePlayerRef.current?.pauseVideo() : videoRef.current?.pause(),
                getTime: () => isYoutube ? (youtubePlayerRef.current?.getCurrentTime ? youtubePlayerRef.current.getCurrentTime() : 0) : (videoRef.current?.currentTime || 0),
                isReady: playerReady,
                requestFullscreen: () => {
                    if (!isYoutube && videoRef.current) {
                        if (videoRef.current.requestFullscreen) videoRef.current.requestFullscreen();
                        else if (videoRef.current.webkitRequestFullscreen) videoRef.current.webkitRequestFullscreen();
                        else if (videoRef.current.msRequestFullscreen) videoRef.current.msRequestFullscreen();
                    }
                }
            }));

            if (isYoutube) {
                return <div className="w-full h-full bg-black rounded-xl overflow-hidden relative"><div id={playerId} className="w-full h-full"></div></div>;
            }
            return (
                <div className="relative w-full h-full">
                    <video ref={videoRef} src={url} controls className="w-full h-full object-contain bg-black rounded-xl" onLoadedMetadata={() => { setPlayerReady(true); if (onReady) onReady(); }} />
                </div>
            );
        });

        // ==================== –î–†–ê–ì–ê–ï–ú –ï–¢–ò–ö–ï–¢ ====================
        const DraggableLabel = ({ text, containerRef }) => {
            const [pos, setPos] = useState({ x: Math.random() * 60 + 20, y: Math.random() * 60 + 20 }); 
            const [isDragging, setIsDragging] = useState(false);
            const offset = useRef({ x: 0, y: 0 });

            const handleStart = (clientX, clientY) => {
                if (!containerRef.current) return;
                const rect = containerRef.current.getBoundingClientRect();
                const currentX = (pos.x / 100) * rect.width;
                const currentY = (pos.y / 100) * rect.height;
                offset.current = {
                    x: clientX - rect.left - currentX,
                    y: clientY - rect.top - currentY
                };
                setIsDragging(true);
            };

            useEffect(() => {
                if (!isDragging) return;

                const handleMove = (e) => {
                    if (!containerRef.current) return;
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    const rect = containerRef.current.getBoundingClientRect();
                    
                    let newX = clientX - rect.left - offset.current.x;
                    let newY = clientY - rect.top - offset.current.y;

                    newX = Math.max(0, Math.min(newX, rect.width - 80));
                    newY = Math.max(0, Math.min(newY, rect.height - 50));

                    setPos({
                        x: (newX / rect.width) * 100,
                        y: (newY / rect.height) * 100
                    });
                };

                const handleEnd = () => setIsDragging(false);

                window.addEventListener('mousemove', handleMove);
                window.addEventListener('mouseup', handleEnd);
                window.addEventListener('touchmove', handleMove);
                window.addEventListener('touchend', handleEnd);

                return () => {
                    window.removeEventListener('mousemove', handleMove);
                    window.removeEventListener('mouseup', handleEnd);
                    window.removeEventListener('touchmove', handleMove);
                    window.removeEventListener('touchend', handleEnd);
                };
            }, [isDragging]);

            return (
                <div 
                    onMouseDown={(e) => handleStart(e.clientX, e.clientY)}
                    onTouchStart={(e) => handleStart(e.touches[0].clientX, e.touches[0].clientY)}
                    className={`absolute px-5 py-3 bg-white/95 backdrop-blur border-2 border-blue-500 rounded-xl shadow-xl cursor-move font-bold text-slate-800 animate-pop select-none draggable-item z-50 ${isDragging ? 'scale-110 shadow-2xl ring-2 ring-blue-300' : ''}`}
                    style={{ left: `${pos.x}%`, top: `${pos.y}%`, transform: 'translate(-50%, -50%)' }}
                >
                    <div className="flex items-center gap-2 text-base sm:text-lg">
                        <Icons.Move className="w-4 h-4 text-blue-400" />
                        {text}
                    </div>
                </div>
            );
        };

        // ==================== –°–¢–£–î–ï–ù–¢–°–ö–ò –ò–ù–¢–ï–†–§–ï–ô–° ====================
        const StudentInterface = ({ videoUrl, questions }) => {
            const playerRef = useRef(null);
            const containerRef = useRef(null);
            const [activeQuestion, setActiveQuestion] = useState(null);
            const [score, setScore] = useState(0);
            const [answeredIds, setAnsweredIds] = useState(new Set());
            const [textAnswer, setTextAnswer] = useState('');
            const [selectedOptions, setSelectedOptions] = useState([]);

            useEffect(() => {
                if (!videoUrl) return;
                const checkTime = () => {
                    if (!playerRef.current || typeof playerRef.current.getTime !== 'function') return;
                    const time = Math.floor(playerRef.current.getTime());
                    const q = questions.find(q => q.time === time && !answeredIds.has(q.id));
                    if (q) {
                        playerRef.current.pause();
                        setActiveQuestion(q);
                        setTextAnswer('');
                        setSelectedOptions([]);
                    }
                };
                const interval = setInterval(checkTime, 500);
                return () => clearInterval(interval);
            }, [questions, answeredIds, videoUrl]);

            const submit = (correct) => {
                const points = activeQuestion.points !== undefined ? activeQuestion.points : 1;
                if (correct === true) setScore(s => s + points);
                setAnsweredIds(new Set([...answeredIds, activeQuestion.id]));
                setActiveQuestion(null);
                playerRef.current.play();
            };

            const toggleFullscreen = () => {
                if (playerRef.current?.requestFullscreen) {
                    playerRef.current.requestFullscreen();
                }
            };

            if (!videoUrl) {
                return (
                    <div className="bg-white border-2 border-dashed border-slate-200 rounded-3xl p-8 sm:p-20 flex flex-col items-center justify-center text-center space-y-4 animate-fade-in min-h-[50vh]">
                        <Icons.Alert className="text-slate-200 w-16 h-16" />
                        <h2 className="text-xl font-bold text-slate-400">–ù—è–º–∞ –∑–∞—Ä–µ–¥–µ–Ω —Ç–µ—Å—Ç</h2>
                        <p className="text-slate-400 text-sm max-w-xs">–ú–æ–ª—è, –≤–ª–µ–∑—Ç–µ –≤ —Ä–µ–∂–∏–º "–î–∏–∑–∞–π–Ω", –∑–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ –≤–∏–¥–µ–æ –∏ –≤—ä–ø—Ä–æ—Å–∏, –∏–ª–∏ –æ—Ç–≤–æ—Ä–µ—Ç–µ —Å–ø–æ–¥–µ–ª–µ–Ω –ª–∏–Ω–∫.</p>
                    </div>
                );
            }

            return (
                <div className="space-y-4 sm:space-y-6 animate-fade-in">
                    <div ref={containerRef} className="relative aspect-video bg-black rounded-2xl sm:rounded-3xl overflow-hidden shadow-xl border-2 sm:border-4 border-white">
                        <MediaPlayer key={videoUrl} ref={playerRef} url={videoUrl} />
                        
                        {/* –ë—É—Ç–æ–Ω –∑–∞ —Ü—è–ª –µ–∫—Ä–∞–Ω (—Å–∞–º–æ –∑–∞ mp4) */}
                        {!getYouTubeId(videoUrl) && (
                            <button 
                                onClick={toggleFullscreen}
                                className="absolute bottom-2 right-2 z-30 bg-black/60 text-white p-3 rounded-lg backdrop-blur-sm active:scale-95 transition-transform"
                                aria-label="–¶—è–ª –µ–∫—Ä–∞–Ω"
                            >
                                <Icons.Fullscreen />
                            </button>
                        )}

                        {activeQuestion && (
                            <div className="absolute inset-0 z-40">
                                {activeQuestion.type !== 'label' && (
                                    <div className="absolute inset-0 bg-slate-900/95 backdrop-blur-md flex items-center justify-center p-3 sm:p-6 overflow-y-auto no-scrollbar">
                                        <div className="bg-white rounded-2xl sm:rounded-3xl p-5 sm:p-8 max-w-full sm:max-w-xl w-full shadow-2xl animate-fade-in relative my-4">
                                            <div className="absolute top-3 right-4 sm:top-4 sm:right-6 flex items-center gap-1 text-slate-400 text-xs font-bold uppercase tracking-wider">
                                                <Icons.Star className="w-4 h-4 text-yellow-500" />
                                                {activeQuestion.points || 1} —Ç.
                                            </div>
                                            <h3 className="text-lg sm:text-xl font-bold mb-5 sm:mb-6 pr-12 break-words">{activeQuestion.text}</h3>
                                            {activeQuestion.type === 'single' && (
                                                <div className="space-y-3">
                                                    {activeQuestion.options.map((opt, i) => (
                                                        <button key={i} onClick={() => submit(i === activeQuestion.correct)} className="w-full text-left p-4 rounded-xl border-2 hover:border-blue-500 transition-all font-medium flex justify-between items-center group active:bg-blue-50">
                                                            <span className="break-words pr-2">{opt}</span>
                                                            <div className="w-5 h-5 rounded-full border-2 border-slate-200 group-hover:border-blue-500 transition-all flex-shrink-0"></div>
                                                        </button>
                                                    ))}
                                                </div>
                                            )}
                                            {activeQuestion.type === 'multiple' && (
                                                <div className="space-y-3">
                                                    {activeQuestion.options.map((opt, i) => (
                                                        <button key={i} onClick={() => setSelectedOptions(prev => prev.includes(i) ? prev.filter(x => x !== i) : [...prev, i])} className={`w-full text-left p-4 rounded-xl border-2 transition-all font-medium flex justify-between items-center group ${selectedOptions.includes(i) ? 'border-blue-500 bg-blue-50 text-blue-700' : 'hover:border-blue-500'}`}>
                                                            <span className="break-words pr-2">{opt}</span>
                                                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all flex-shrink-0 ${selectedOptions.includes(i) ? 'bg-blue-600 border-blue-600' : 'border-slate-200 group-hover:border-blue-500'}`}>{selectedOptions.includes(i) && <Icons.Check className="text-white w-3 h-3" />}</div>
                                                        </button>
                                                    ))}
                                                    <button onClick={() => {
                                                        const isCorrect = Array.isArray(activeQuestion.correct) && 
                                                            activeQuestion.correct.length === selectedOptions.length &&
                                                            activeQuestion.correct.every(val => selectedOptions.includes(val));
                                                        submit(isCorrect);
                                                    }} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition-colors mt-2 active:bg-blue-800">–ü–æ—Ç–≤—ä—Ä–¥–∏</button>
                                                </div>
                                            )}
                                            {activeQuestion.type === 'text' && (
                                                <div className="space-y-4">
                                                    <input value={textAnswer} onChange={e => setTextAnswer(e.target.value)} className="w-full p-4 rounded-xl border-2 outline-none focus:border-blue-500 transition-all text-base" placeholder="–ù–∞–ø–∏—à–µ—Ç–µ –≤–∞—à–∏—è –æ—Ç–≥–æ–≤–æ—Ä..." />
                                                    <button onClick={() => submit(textAnswer.trim().toLowerCase() === activeQuestion.correct.toLowerCase())} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition-colors active:bg-blue-800">–ò–∑–ø—Ä–∞—Ç–∏ –æ—Ç–≥–æ–≤–æ—Ä</button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {activeQuestion.type === 'label' && (
                                    <div className="absolute inset-0 bg-slate-900/60">
                                        <div className="absolute top-3 left-1/2 transform -translate-x-1/2 bg-white/95 px-5 py-3 rounded-full shadow-lg z-50 text-center animate-fade-in w-[90%] sm:w-auto">
                                            <div className="flex items-center gap-2 justify-center mb-1">
                                                <Icons.Chat className="text-blue-500 w-5 h-5" />
                                                <span className="font-bold text-slate-800">–î–∏—Å–∫—É—Å–∏—è</span>
                                            </div>
                                            <p className="text-sm sm:text-base font-medium text-slate-600 break-words">{activeQuestion.text}</p>
                                        </div>
                                        {activeQuestion.options.map((label, i) => (
                                            <DraggableLabel key={`${activeQuestion.id}-${i}`} text={label} containerRef={containerRef} />
                                        ))}
                                        <button 
                                            onClick={() => submit(null)} 
                                            className="absolute bottom-8 left-1/2 transform -translate-x-1/2 bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-xl font-bold shadow-xl transition-all active:scale-95 z-50 text-base min-h-[44px]"
                                        >
                                            –ü—Ä–æ–¥—ä–ª–∂–∏ (0 —Ç.)
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                    <div className="grid grid-cols-2 gap-3 sm:gap-4">
                        <div className="bg-white p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-sm border text-center">
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">–ü—Ä–æ–≥—Ä–µ—Å</p>
                            <p className="text-2xl sm:text-3xl font-black text-slate-800">{answeredIds.size} / {questions.length}</p>
                        </div>
                        <div className="bg-white p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-sm border text-center">
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">–¢–æ—á–∫–∏</p>
                            <p className="text-2xl sm:text-3xl font-black text-green-600">{score}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== –£–ß–ò–¢–ï–õ–°–ö–ò –ò–ù–¢–ï–†–§–ï–ô–° ====================
        const TeacherDashboard = ({ questions, setQuestions, videoUrl, setVideoUrl, onCopyLink, shareStatus, shareError, generateShareLink, isSharedMode, resetApp }) => {
            const playerRef = useRef(null);
            const fileInputRef = useRef(null);
            const [playerReady, setPlayerReady] = useState(false);
            const [newQ, setNewQ] = useState({ text: '', time: 0, type: 'single', options: ['', ''], correct: 0, points: 1 });
            const [editingId, setEditingId] = useState(null);
            const [showQR, setShowQR] = useState(false);
            const [currentShareLink, setCurrentShareLink] = useState('');

            const isYouTube = getYouTubeId(videoUrl);

            const handleEdit = (q) => {
                setNewQ({ ...q, points: q.points ?? 1 }); 
                setEditingId(q.id); 
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            };

            const handleSaveQuestion = () => {
                if (!newQ.text) return;
                const questionToSave = { ...newQ, points: parseInt(newQ.points) || 0 };

                if (editingId) {
                    setQuestions(questions.map(q => q.id === editingId ? { ...questionToSave, id: editingId } : q));
                    setEditingId(null);
                } else {
                    setQuestions([...questions, { ...questionToSave, id: Date.now() }]);
                }
                setNewQ({ text: '', time: 0, type: 'single', options: ['', ''], correct: 0, points: 1 });
            };

            const handleCancelEdit = () => {
                setEditingId(null);
                setNewQ({ text: '', time: 0, type: 'single', options: ['', ''], correct: 0, points: 1 });
            };

            const handleClearAll = () => {
                if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ? –¢–æ–≤–∞ —â–µ –∏–∑—Ç—Ä–∏–µ —Ç–µ–∫—É—â–æ—Ç–æ –≤–∏–¥–µ–æ –∏ –≤—Å–∏—á–∫–∏ –≤—ä–ø—Ä–æ—Å–∏.')) {
                    setVideoUrl('');
                    setQuestions([]);
                    setNewQ({ text: '', time: 0, type: 'single', options: ['', ''], correct: 0, points: 1 });
                    setEditingId(null);
                    localStorage.removeItem('vq_videoUrl');
                    localStorage.removeItem('vq_questions');
                }
            };

            const handleExport = () => {
                const data = { videoUrl, questions };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `video-quiz-${new Date().toISOString().slice(0,10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const handleImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.videoUrl) setVideoUrl(data.videoUrl);
                        if (data.questions) setQuestions(data.questions);
                    } catch (err) {
                        alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞!');
                    }
                };
                reader.readAsText(file);
                e.target.value = null;
            };

            const addLabelOption = () => {
                setNewQ({ ...newQ, options: [...newQ.options, '–ù–æ–≤ –µ—Ç–∏–∫–µ—Ç'] });
            };
            const removeLabelOption = (index) => {
                const updated = newQ.options.filter((_, i) => i !== index);
                setNewQ({ ...newQ, options: updated });
            };

            const handleShowQR = () => {
                setCurrentShareLink(generateShareLink());
                setShowQR(true);
            };

            const isLinkTooLong = currentShareLink.length > 1900;

            return (
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 sm:gap-8 animate-fade-in">
                    {/* –õ–Ø–í–ê –ö–û–õ–û–ù–ê - –í–ò–î–ï–û –ò –í–™–ü–†–û–°–ò */}
                    <div className="lg:col-span-8 space-y-6">
                        <div className="bg-white p-4 sm:p-6 rounded-2xl sm:rounded-3xl border shadow-sm relative">
                            <div className="absolute top-4 right-4 sm:top-6 sm:right-6 flex items-center gap-2">
                                <input type="file" ref={fileInputRef} onChange={handleImport} className="hidden" accept=".txt,.json" />
                                <button onClick={() => fileInputRef.current.click()} className="p-2 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded-lg transition-colors" title="–ó–∞—Ä–µ–¥–∏ –æ—Ç —Ñ–∞–π–ª"><Icons.Upload /></button>
                                <button onClick={handleExport} className="p-2 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded-lg transition-colors" title="–ó–∞–ø–∞–∑–∏ –∫–∞—Ç–æ —Ñ–∞–π–ª"><Icons.Download /></button>
                                <div className="w-px h-6 bg-slate-200 mx-1"></div>
                                <button onClick={handleClearAll} className="flex items-center gap-1 text-xs font-bold text-red-500 bg-red-50 hover:bg-red-100 px-3 py-2 rounded-lg transition-colors min-h-[44px]"><Icons.Refresh /> –ù–æ–≤</button>
                            </div>
                            <h2 className="text-lg sm:text-xl font-bold mb-4 flex items-center gap-2"><Icons.Video /> –í–∏–¥–µ–æ –∏–∑—Ç–æ—á–Ω–∏–∫ {isYouTube && <span className="bg-red-50 text-red-600 text-[10px] px-2 py-1 rounded-full flex items-center gap-1"><Icons.Youtube /> YouTube</span>}</h2>
                            {videoUrl ? (
                                <div className="w-full aspect-video bg-black rounded-xl mb-4 overflow-hidden">
                                    <MediaPlayer key={videoUrl} ref={playerRef} url={videoUrl} onReady={() => setPlayerReady(true)} />
                                </div>
                            ) : (
                                <div className="w-full aspect-video bg-slate-50 rounded-xl mb-4 flex flex-col items-center justify-center border-2 border-dashed border-slate-200 p-4 text-center">
                                    <p className="text-slate-400 text-sm mb-2">–ù—è–º–∞ –≤—ä–≤–µ–¥–µ–Ω–æ –≤–∏–¥–µ–æ</p>
                                    <button onClick={() => setVideoUrl('https://www.youtube.com/watch?v=aqz-KE-bpKQ')} className="text-blue-600 text-xs sm:text-sm font-bold hover:underline min-h-[44px] px-4">üì∫ –ó–∞—Ä–µ–¥–∏ YouTube –ø—Ä–∏–º–µ—Ä</button>
                                </div>
                            )}
                            <div className="flex flex-col sm:flex-row gap-2">
                                <input value={videoUrl} onChange={e => setVideoUrl(e.target.value)} className="flex-1 p-3 rounded-xl border outline-none focus:ring-2 focus:ring-blue-500 transition-all text-base" placeholder="YouTube –ª–∏–Ω–∫ –∏–ª–∏ .mp4 —Ñ–∞–π–ª..." />
                            </div>
                        </div>

                        <div className="space-y-4">
                            <h2 className="text-lg sm:text-xl font-bold px-2">–í—ä–ø—Ä–æ—Å–∏ ({questions.length})</h2>
                            {questions.sort((a,b) => a.time - b.time).map(q => (
                                <div key={q.id} className={`bg-white p-4 rounded-xl sm:rounded-2xl border flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 group hover:border-blue-200 transition-all ${editingId === q.id ? 'border-blue-500 bg-blue-50 shadow-md' : ''}`}>
                                    <div className="w-full sm:w-auto">
                                        <div className="flex items-center gap-2 mb-1 flex-wrap">
                                            <span className="text-[10px] bg-slate-800 text-white px-2 py-0.5 rounded font-mono">{q.time} —Å–µ–∫</span>
                                            <span className={`text-[10px] uppercase font-bold tracking-wider ${q.type === 'label' ? 'text-purple-500' : 'text-blue-500'}`}>{q.type === 'single' ? '–ò–∑–±–æ—Ä' : q.type === 'multiple' ? '–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω' : q.type === 'label' ? '–ï—Ç–∏–∫–µ—Ç–∏' : '–¢–µ–∫—Å—Ç'}</span>
                                            <span className="text-[10px] text-slate-400 font-bold bg-slate-100 px-2 rounded-full">{q.points ?? 1} —Ç.</span>
                                            {editingId === q.id && <span className="text-[10px] font-bold text-blue-600 bg-white px-2 rounded-full animate-pulse">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ...</span>}
                                        </div>
                                        <span className="font-bold text-slate-700 break-words">{q.text}</span>
                                        {q.type === 'label' && q.options?.length > 0 && (
                                            <div className="mt-2 flex flex-wrap gap-1">
                                                {q.options.map((label, i) => (
                                                    <span key={i} className="text-[10px] bg-purple-50 text-purple-700 px-2 py-0.5 rounded-full">üè∑Ô∏è {label}</span>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    <div className="flex gap-2 self-end sm:self-center">
                                        <button onClick={() => handleEdit(q)} className="text-slate-400 hover:text-blue-500 hover:bg-blue-50 p-3 rounded-lg transition-all min-h-[44px] min-w-[44px]" title="–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π"><Icons.Edit /></button>
                                        <button onClick={() => setQuestions(questions.filter(x => x.id !== q.id))} className="text-slate-300 hover:text-red-500 hover:bg-red-50 p-3 rounded-lg transition-all min-h-[44px] min-w-[44px]" title="–ò–∑—Ç—Ä–∏–π"><Icons.Trash /></button>
                                    </div>
                                </div>
                            ))}
                            {questions.length === 0 && <div className="text-center py-10 border-2 border-dashed rounded-2xl sm:rounded-3xl text-slate-400">–ù—è–º–∞ –¥–æ–±–∞–≤–µ–Ω–∏ –º–æ–º–µ–Ω—Ç–∏ –∑–∞ —Å–ø–∏—Ä–∞–Ω–µ.</div>}
                        </div>
                    </div>

                    {/* –î–Ø–°–ù–ê –ö–û–õ–û–ù–ê - –°–ü–û–î–ï–õ–Ø–ù–ï –ò –†–ï–î–ê–ö–¢–û–† */}
                    <div className="lg:col-span-4 space-y-6">
                        {/* –ü–ê–ù–ï–õ –ó–ê –°–ü–û–î–ï–õ–Ø–ù–ï */}
                        <div className="bg-blue-600 p-5 sm:p-6 rounded-2xl sm:rounded-3xl text-white shadow-xl">
                            <h3 className="text-lg font-bold mb-2 flex items-center gap-2">–°–ø–æ–¥–µ–ª—è–Ω–µ</h3>
                            <p className="text-sm opacity-80 mb-4 sm:mb-6">–õ–∏–Ω–∫—ä—Ç –≤–∫–ª—é—á–≤–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–º–µ–Ω–∏. –ü—Ä–∏ –¥—ä–ª—ä–≥ –ª–∏–Ω–∫ ‚Äì –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ QR –∏–ª–∏ —Ñ–∞–π–ª.</p>
                            <button onClick={onCopyLink} className="w-full bg-white text-blue-600 py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-50 transition-all active:scale-95 disabled:opacity-50 mb-2 min-h-[44px] text-base" disabled={!videoUrl}>
                                {shareStatus ? <Icons.Check className="w-5 h-5" /> : <Icons.Share />} {shareStatus || '–ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫'}
                            </button>
                            {currentShareLink && isLinkTooLong && (
                                <div className="mt-2 text-xs bg-yellow-300 text-yellow-900 p-3 rounded-lg flex items-start gap-2">
                                    <Icons.Alert className="w-4 h-4 flex-shrink-0 mt-0.5" />
                                    <span>‚ö†Ô∏è –õ–∏–Ω–∫—ä—Ç –µ –º–Ω–æ–≥–æ –¥—ä–ª—ä–≥ ({currentShareLink.length} —Å–∏–º–≤–æ–ª–∞). –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ QR –∫–æ–¥ –∏–ª–∏ —Ñ–∞–π–ª.</span>
                                </div>
                            )}
                            <div className="flex flex-col sm:flex-row gap-2 mt-3">
                                <button onClick={handleShowQR} disabled={!videoUrl} className="flex-1 bg-blue-500 hover:bg-blue-400 text-white py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-1 transition-colors disabled:opacity-50 min-h-[44px]">üì≤ QR –∫–æ–¥</button>
                                <button onClick={handleExport} disabled={!videoUrl} className="flex-1 bg-blue-500 hover:bg-blue-400 text-white py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-1 transition-colors disabled:opacity-50 min-h-[44px]"><Icons.Download className="w-4 h-4" /> –§–∞–π–ª</button>
                            </div>
                            {shareError && <p className="text-xs mt-2 text-white/80">{shareError}</p>}
                        </div>

                        {/* QR –ö–û–î –ú–û–î–ê–õ */}
                        {showQR && (
                            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[100] p-4" onClick={() => setShowQR(false)}>
                                <div className="bg-white p-5 sm:p-6 rounded-2xl sm:rounded-3xl max-w-[90%] sm:max-w-sm w-full shadow-2xl animate-fade-in" onClick={e => e.stopPropagation()}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h4 className="font-bold text-lg">QR –∫–æ–¥ –∑–∞ —Ç–µ—Å—Ç–∞</h4>
                                        <button onClick={() => setShowQR(false)} className="text-slate-400 hover:text-slate-600 p-2 min-h-[44px] min-w-[44px]"><Icons.X /></button>
                                    </div>
                                    <div className="bg-white p-4 rounded-2xl flex flex-col items-center">
                                        <QRCodeSVG value={currentShareLink} size={200} />
                                        <p className="text-xs text-slate-500 mt-4 break-all text-center">
                                            {currentShareLink.length > 100 ? currentShareLink.slice(0, 70) + '‚Ä¶' : currentShareLink}
                                        </p>
                                        <p className="text-xs text-slate-400 mt-2">–°–∫–∞–Ω–∏—Ä–∞–π—Ç–µ —Å —Ç–µ–ª–µ—Ñ–æ–Ω –∑–∞ –¥–æ—Å—Ç—ä–ø –¥–æ —Ç–µ—Å—Ç–∞.</p>
                                        <button onClick={() => { navigator.clipboard.writeText(currentShareLink); alert('–õ–∏–Ω–∫—ä—Ç –µ –∫–æ–ø–∏—Ä–∞–Ω!'); }} className="mt-4 text-sm text-blue-600 underline min-h-[44px] px-4">üìã –ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫–∞</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* –ü–ê–ù–ï–õ –ó–ê –î–û–ë–ê–í–Ø–ù–ï/–†–ï–î–ê–ö–¢–ò–†–ê–ù–ï –ù–ê –í–™–ü–†–û–° */}
                        <div className={`bg-white p-5 sm:p-6 rounded-2xl sm:rounded-3xl border shadow-xl transition-all ${editingId ? 'ring-2 ring-blue-500 ring-offset-2' : ''}`}>
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold flex items-center gap-2 text-base sm:text-lg">{editingId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ' : '–ù–æ–≤ –º–æ–º–µ–Ω—Ç'}</h3>
                                {editingId && <button onClick={handleCancelEdit} className="text-xs text-slate-400 hover:text-slate-600 bg-slate-100 px-3 py-2 rounded-lg min-h-[44px]"><Icons.X /> –û—Ç–∫–∞–∑</button>}
                            </div>
                            <div className="space-y-4">
                                {/* –¢–∏–ø –≤—ä–ø—Ä–æ—Å - —Å–∫—Ä–æ–ª –ø—Ä–∏ –Ω—É–∂–¥–∞ */}
                                <div className="flex bg-slate-100 p-1 rounded-lg gap-1 overflow-x-auto no-scrollbar">
                                    <button onClick={() => setNewQ({...newQ, type: 'single', correct: 0, points: 1, options: ['', '']})} className={`flex-1 py-2 px-2 text-xs font-bold rounded-md transition-all whitespace-nowrap min-h-[44px] ${newQ.type === 'single' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>–ò–∑–±–æ—Ä</button>
                                    <button onClick={() => setNewQ({...newQ, type: 'multiple', correct: [], points: 1, options: ['', '']})} className={`flex-1 py-2 px-2 text-xs font-bold rounded-md transition-all whitespace-nowrap min-h-[44px] ${newQ.type === 'multiple' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω</button>
                                    <button onClick={() => setNewQ({...newQ, type: 'text', correct: '', points: 1, options: ['', '']})} className={`flex-1 py-2 px-2 text-xs font-bold rounded-md transition-all whitespace-nowrap min-h-[44px] ${newQ.type === 'text' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>–¢–µ–∫—Å—Ç</button>
                                    <button onClick={() => setNewQ({...newQ, type: 'label', correct: null, points: 0, options: ['–ï—Ç–∏–∫–µ—Ç 1', '–ï—Ç–∏–∫–µ—Ç 2']})} className={`flex-1 py-2 px-2 text-xs font-bold rounded-md transition-all whitespace-nowrap min-h-[44px] ${newQ.type === 'label' ? 'bg-white shadow text-purple-600' : 'text-slate-500'}`}>–ï—Ç–∏–∫–µ—Ç–∏</button>
                                </div>
                                
                                <textarea value={newQ.text} onChange={e => setNewQ({...newQ, text: e.target.value})} className="w-full p-3 border rounded-xl outline-none focus:border-blue-500 transition-all text-base" rows="3" placeholder={newQ.type === 'label' ? "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞ –¥–∏—Å–∫—É—Å–∏—è..." : "–ö–∞–∫—ä–≤ –µ –≤—ä–ø—Ä–æ—Å—ä—Ç?"} />
                                
                                {/* –í—Ä–µ–º–µ –∏ —Ç–æ—á–∫–∏ - —Å—Ç–µ–∫ –Ω–∞ –º–æ–±–∏–ª–Ω–æ */}
                                <div className="flex flex-col sm:flex-row gap-3">
                                    <div className="flex-1">
                                        <label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase tracking-wider">–í—Ä–µ–º–µ (—Å–µ–∫)</label>
                                        <div className="flex gap-2">
                                            <input type="number" value={newQ.time} onChange={e => setNewQ({...newQ, time: parseInt(e.target.value) || 0})} className="flex-1 p-3 border rounded-lg text-base font-mono" />
                                            <button onClick={() => videoUrl && playerReady && playerRef.current?.getTime && setNewQ({...newQ, time: Math.floor(playerRef.current.getTime())})} className="px-4 bg-blue-50 text-blue-600 rounded-lg text-xs font-bold hover:bg-blue-100 border border-blue-100 transition-all flex items-center justify-center disabled:opacity-50 min-h-[44px] min-w-[44px]" disabled={!videoUrl || !playerReady} title="–í–∑–µ–º–∏ –æ—Ç –≤–∏–¥–µ–æ—Ç–æ"><Icons.Clock className="w-5 h-5" /></button>
                                        </div>
                                    </div>
                                    <div className="w-full sm:w-1/3">
                                        <label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase tracking-wider">–¢–æ—á–∫–∏</label>
                                        <input type="number" value={newQ.points} onChange={e => setNewQ({...newQ, points: parseInt(e.target.value) || 0})} className="w-full p-3 border rounded-lg text-base font-mono text-center" />
                                    </div>
                                </div>

                                {/* –û–ø—Ü–∏–∏ –∑–∞ –∏–∑–±–æ—Ä */}
                                {(newQ.type === 'single' || newQ.type === 'multiple') && (
                                    <div className="space-y-2">
                                        <label className="text-[10px] font-bold text-slate-400 block uppercase tracking-wider">–û–ø—Ü–∏–∏ (–º–∞—Ä–∫–∏—Ä–∞–π—Ç–µ –≤–µ—Ä–Ω–∏—Ç–µ)</label>
                                        {newQ.options.map((o, i) => (
                                            <div key={i} className="flex gap-2 items-center">
                                                {newQ.type === 'single' ? (
                                                    <input type="radio" checked={newQ.correct === i} onChange={() => setNewQ({...newQ, correct: i})} className="w-5 h-5 cursor-pointer accent-blue-600 flex-shrink-0" />
                                                ) : (
                                                    <input type="checkbox" checked={Array.isArray(newQ.correct) ? newQ.correct.includes(i) : false} onChange={() => {
                                                        const currentCorrect = Array.isArray(newQ.correct) ? newQ.correct : [];
                                                        const newCorrect = currentCorrect.includes(i) ? currentCorrect.filter(c => c !== i) : [...currentCorrect, i];
                                                        setNewQ({...newQ, correct: newCorrect});
                                                    }} className="w-5 h-5 cursor-pointer accent-blue-600 flex-shrink-0" />
                                                )}
                                                <input value={o} onChange={e => { const opts = [...newQ.options]; opts[i] = e.target.value; setNewQ({...newQ, options: opts}); }} className="flex-1 p-3 border rounded-lg text-base outline-none focus:border-blue-300 transition-all" placeholder={`–û–ø—Ü–∏—è ${i+1}`} />
                                                {newQ.options.length > 1 && <button onClick={() => { const opts = newQ.options.filter((_, idx) => idx !== i); setNewQ({...newQ, options: opts}); }} className="text-red-400 hover:text-red-600 p-2 min-h-[44px] min-w-[44px]"><Icons.X /></button>}
                                            </div>
                                        ))}
                                        <button onClick={() => setNewQ({...newQ, options: [...newQ.options, '']})} className="text-xs sm:text-sm text-blue-600 font-bold py-2 px-4 min-h-[44px]">+ –î–æ–±–∞–≤–∏ –æ—â–µ</button>
                                    </div>
                                )}

                                {/* –ï—Ç–∏–∫–µ—Ç–∏ */}
                                {newQ.type === 'label' && (
                                    <div className="space-y-2">
                                        <label className="text-[10px] font-bold text-slate-400 block uppercase tracking-wider">–ï—Ç–∏–∫–µ—Ç–∏ –∑–∞ –≤–ª–∞—á–µ–Ω–µ</label>
                                        {newQ.options.map((label, i) => (
                                            <div key={i} className="flex gap-2 items-center">
                                                <span className="text-purple-500 text-lg">üè∑Ô∏è</span>
                                                <input value={label} onChange={e => { const opts = [...newQ.options]; opts[i] = e.target.value; setNewQ({...newQ, options: opts}); }} className="flex-1 p-3 border rounded-lg text-base outline-none focus:border-purple-300 transition-all" placeholder={`–ï—Ç–∏–∫–µ—Ç ${i+1}`} />
                                                {newQ.options.length > 1 && <button onClick={() => removeLabelOption(i)} className="text-red-400 hover:text-red-600 p-2 min-h-[44px] min-w-[44px]"><Icons.X /></button>}
                                            </div>
                                        ))}
                                        <button onClick={addLabelOption} className="text-xs sm:text-sm text-purple-600 font-bold py-2 px-4 min-h-[44px]">+ –î–æ–±–∞–≤–∏ –µ—Ç–∏–∫–µ—Ç</button>
                                    </div>
                                )}

                                {/* –¢–µ–∫—Å—Ç–æ–≤ –æ—Ç–≥–æ–≤–æ—Ä */}
                                {newQ.type === 'text' && (
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase tracking-wider">–û—á–∞–∫–≤–∞–Ω –≤–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä</label>
                                        <input value={newQ.correct} onChange={e => setNewQ({...newQ, correct: e.target.value})} className="w-full p-3 border rounded-lg text-base outline-none focus:border-blue-300" placeholder="–ù–∞–ø—Ä. –ü–∞—Ä–∏–∂" />
                                    </div>
                                )}

                                {/* –ë—É—Ç–æ–Ω –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ */}
                                <button onClick={handleSaveQuestion} className={`w-full text-white py-4 rounded-xl font-bold transition-all shadow-lg active:scale-95 disabled:opacity-50 text-base min-h-[44px] ${editingId ? 'bg-blue-600 hover:bg-blue-700' : 'bg-slate-800 hover:bg-slate-900'}`} disabled={!videoUrl}>
                                    {editingId ? '–ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ' : '–î–æ–±–∞–≤–∏ –∫—ä–º —Ç–µ—Å—Ç–∞'}
                                </button>
                                {editingId && (
                                    <button onClick={handleCancelEdit} className="w-full py-3 text-sm font-bold text-slate-500 hover:text-slate-700 min-h-[44px]">–û—Ç–∫–∞–∑</button>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== APP ====================
        const App = () => {
            const [view, setView] = useState('student');
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [password, setPassword] = useState('');
            const [videoUrl, setVideoUrl] = useState('');
            const [questions, setQuestions] = useState([]);
            const [shareStatus, setShareStatus] = useState('');
            const [shareError, setShareError] = useState('');
            const [isSharedMode, setIsSharedMode] = useState(false);

            useEffect(() => {
                const hash = window.location.hash.substring(1);
                if (hash) {
                    try {
                        const decompressed = LZString.decompressFromEncodedURIComponent(hash);
                        if (!decompressed) throw new Error('–ù–µ—É—Å–ø–µ—à–Ω–∞ –¥–µ–∫–æ–º–ø—Ä–µ—Å–∏—è');
                        const decodedData = JSON.parse(decompressed);
                        if (decodedData.videoUrl) setVideoUrl(decodedData.videoUrl);
                        if (decodedData.questions) setQuestions(decodedData.questions);
                        setIsSharedMode(true); 
                    } catch (e) { 
                        console.error("–ù–µ–≤–∞–ª–∏–¥–µ–Ω –ª–∏–Ω–∫", e);
                        alert('–õ–∏–Ω–∫—ä—Ç –Ω–µ —Å—ä–¥—ä—Ä–∂–∞ –≤–∞–ª–∏–¥–µ–Ω —Ç–µ—Å—Ç. –©–µ —Å–µ –∑–∞—Ä–µ–¥–∏ –ø—Ä–∞–∑–µ–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä.');
                    }
                } else {
                    const savedVideo = localStorage.getItem('vq_videoUrl');
                    const savedQuestions = localStorage.getItem('vq_questions');
                    if (savedVideo) setVideoUrl(savedVideo);
                    if (savedQuestions) setQuestions(JSON.parse(savedQuestions));
                }
            }, []);

            useEffect(() => {
                if (!isSharedMode) {
                    if (videoUrl) localStorage.setItem('vq_videoUrl', videoUrl);
                    localStorage.setItem('vq_questions', JSON.stringify(questions));
                }
            }, [videoUrl, questions, isSharedMode]);

            const generateShareLink = () => {
                const data = { videoUrl, questions };
                const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(data));
                return `${window.location.origin}${window.location.pathname}#${compressed}`;
            };

            const handleCopyLink = () => {
                const link = generateShareLink();
                navigator.clipboard.writeText(link).then(() => {
                    setShareStatus('–ö–æ–ø–∏—Ä–∞–Ω–æ!');
                    setShareError('');
                    setTimeout(() => setShareStatus(''), 3000);
                }).catch(() => {
                    setShareError('–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∫–æ–ø–∏—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –õ–∏–Ω–∫—ä—Ç –µ –≤ –∞–¥—Ä–µ—Å–Ω–∞—Ç–∞ –ª–µ–Ω—Ç–∞.');
                    setShareStatus('');
                });
            };

            const resetApp = () => {
                window.location.hash = '';
                window.location.reload();
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <nav className="bg-white border-b px-4 sm:px-6 py-3 sm:py-4 flex justify-between items-center sticky top-0 z-50 shadow-sm">
                        <div className="flex items-center gap-2 text-blue-600">
                            <Icons.Video />
                            <h1 className="text-lg sm:text-xl font-extrabold text-slate-800 tracking-tight">VideoQuiz <span className="text-blue-600">Lite+</span></h1>
                        </div>
                        <div className="flex gap-1 sm:gap-2 bg-slate-100 p-1 rounded-xl">
                            <button onClick={() => setView('student')} className={`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all min-h-[44px] ${view === 'student' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>–†–µ—à–∞–≤–∞–Ω–µ</button>
                            {!isSharedMode ? (
                                <button onClick={() => setView('teacher')} className={`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold transition-all min-h-[44px] ${view === 'teacher' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>–î–∏–∑–∞–π–Ω</button>
                            ) : (
                                <button onClick={resetApp} className="px-3 py-2 text-xs font-bold text-slate-500 hover:text-blue-600 transition-colors flex items-center gap-1 min-h-[44px]" title="–ò–∑—á–∏—Å—Ç–∏ –ª–∏–Ω–∫–∞ –∏ —Å—ä–∑–¥–∞–π –Ω–æ–≤ —Ç–µ—Å—Ç">
                                    <Icons.Plus /> –ù–æ–≤
                                </button>
                            )}
                        </div>
                    </nav>

                    <main className="flex-1 max-w-6xl w-full mx-auto p-4 sm:p-6">
                        {view === 'student' ? (
                            <StudentInterface videoUrl={videoUrl} questions={questions} />
                        ) : (
                            !isAuthenticated ? (
                                <div className="max-w-md mx-auto mt-10 sm:mt-20 bg-white p-6 sm:p-8 rounded-2xl sm:rounded-3xl shadow-xl border text-center animate-fade-in">
                                    <div className="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6"><Icons.Lock /></div>
                                    <h2 className="text-2xl font-bold mb-2">–†–µ–∂–∏–º –î–∏–∑–∞–π–Ω</h2>
                                    <p className="text-slate-500 text-sm mb-6">–í—ä–≤–µ–¥–µ—Ç–µ –ø–∞—Ä–æ–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç—ä–ø –¥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</p>
                                    <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="–ü–∞—Ä–æ–ª–∞..." className="w-full px-4 py-3 rounded-xl border mb-4 outline-none focus:ring-2 focus:ring-blue-500 transition-all text-base" />
                                    <button onClick={() => password === 'admin' ? setIsAuthenticated(true) : alert('–ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞')} className="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 transition-colors shadow-lg shadow-blue-100 min-h-[44px]">–í–ª–µ–∑ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ</button>
                                </div>
                            ) : (
                                <TeacherDashboard 
                                    questions={questions} 
                                    setQuestions={setQuestions} 
                                    videoUrl={videoUrl} 
                                    setVideoUrl={setVideoUrl} 
                                    onCopyLink={handleCopyLink}
                                    shareStatus={shareStatus}
                                    shareError={shareError}
                                    generateShareLink={generateShareLink}
                                    isSharedMode={isSharedMode} 
                                    resetApp={resetApp} 
                                />
                            )
                        )}
                    </main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
